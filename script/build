#!/bin/sh

# Example
# ./script/build jit_loop jit_loop_test test/jit_loop.ml "1 1 7 1 10 4 2 13 6 0 5 3 5 7"

jbuilder build && \
    jbuilder build test/"$2".exe && \
    _build/default/test/"$2".exe "$3" "$4" && \
    ./min-caml test/"$1".ml && \
    gcc -c -g -m32 -O2 "$2".s && \
    gcc -g -m32 -Wall lib/libmincaml.s lib/stub.c test/"$1".s "$2".o -o "$2" && \
    rm -rf "$2".dSYM
