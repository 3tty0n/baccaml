open MinCaml
open Asm
open Opt_defuse
open Opt_lib

let trace_loop1 =
  Let (("Ti242.609", Int),  Sub ("sp.400",C 5 ),
  Let (("Ti244.611", Int),  Sub ("Ti242.609",C 1 ),
  Let (("v.612", Int),  Ld ("stack.399",V "Ti244.611",4),
  Let (("Tu24.613", Unit),  St ("v.612","stack.399",V "sp.400",4),
  Let (("Ti246.615", Int),  Add ("sp.400",C 1 ),
  Let (("stack.399.849", Int),  Mov ("stack.399"),
  Let (("sp.400.848", Int),  Mov ("Ti246.615"),
  Let (("Ti242.609.937", Int),  Sub ("sp.400.848",C 7 ),
  Let (("Ti244.611.938", Int),  Sub ("Ti242.609.937",C 1 ),
  Let (("v.612.939", Int),  Ld ("stack.399.849",V "Ti244.611.938",4),
  Let (("Tu24.613.940", Unit),  St ("v.612.939","stack.399.849",V "sp.400.848",4),
  Let (("Ti246.615.941", Int),  Add ("sp.400.848",C 1 ),
  Let (("stack.399.1072", Int),  Mov ("stack.399.849"),
  Let (("sp.400.1071", Int),  Mov ("Ti246.615.941"),
  Let (("Ti149.724.1225", Int),  Sub ("sp.400.1071",C 1 ),
  Let (("v2.725.1226", Int),  Ld ("stack.399.1072",V "Ti149.724.1225",4),
  Let (("Ti151.727.1227", Int),  Sub ("sp.400.1071",C 2 ),
  Let (("v1.728.1228", Int),  Ld ("stack.399.1072",V "Ti151.727.1227",4),
  Let (("n.729.1229", Int),  IfLE ("v1.728.1228",V "v2.725.1226",
  Ans (Set (1)),
  Ans (Set (0))),
  Let (("Ti153.731.1230", Int),  Sub ("sp.400.1071",C 2 ),
  Let (("Tu12.732.1231", Unit),  St ("n.729.1229","stack.399.1072",V "Ti153.731.1230",4),
  Let (("Ti155.734.1232", Int),  Sub ("sp.400.1071",C 1 ),
  Let (("stack.399.1295", Int),  Mov ("stack.399.1072"),
  Let (("sp.400.1294", Int),  Mov ("Ti155.734.1232"),
  Let (("Ti191.680.1421", Int),  Sub ("sp.400.1294",C 1 ),
  Let (("v.681.1422", Int),  Ld ("stack.399.1295",V "Ti191.680.1421",4),
  Let (("sp2.683.1423", Int),  Sub ("sp.400.1294",C 1 ),
  Ans (IfEq ("v.681.1422",C 0 ,
  Let (("stack.399.1518", Int),  Mov ("stack.399.1295"),
  Let (("sp.400.1517", Int),  Mov ("sp2.683.1423"),
  Let (("Ti242.609.1606", Int),  Sub ("sp.400.1517",C 4 ),
  Let (("Ti244.611.1607", Int),  Sub ("Ti242.609.1606",C 1 ),
  Let (("v.612.1608", Int),  Ld ("stack.399.1518",V "Ti244.611.1607",4),
  Let (("Tu24.613.1609", Unit),  St ("v.612.1608","stack.399.1518",V "sp.400.1517",4),
  Let (("Ti246.615.1610", Int),  Add ("sp.400.1517",C 1 ),
  Let (("stack.399.1741", Int),  Mov ("stack.399.1518"),
  Let (("sp.400.1740", Int),  Mov ("Ti246.615.1610"),
  Let (("Ti242.609.1829", Int),  Sub ("sp.400.1740",C 7 ),
  Let (("Ti244.611.1830", Int),  Sub ("Ti242.609.1829",C 1 ),
  Let (("v.612.1831", Int),  Ld ("stack.399.1741",V "Ti244.611.1830",4),
  Let (("Tu24.613.1832", Unit),  St ("v.612.1831","stack.399.1741",V "sp.400.1740",4),
  Let (("Ti246.615.1833", Int),  Add ("sp.400.1740",C 1 ),
  Let (("stack.399.1964", Int),  Mov ("stack.399.1741"),
  Let (("sp.400.1963", Int),  Mov ("Ti246.615.1833"),
  Let (("Ti262.582.2034", Int),  Sub ("sp.400.1963",C 1 ),
  Let (("n.583.2035", Int),  Ld ("stack.399.1964",V "Ti262.582.2034",4),
  Let (("Ti264.585.2036", Int),  Sub ("sp.400.1963",C 2 ),
  Let (("Ti265.586.2037", Int),  Ld ("stack.399.1964",V "Ti264.585.2036",4),
  Let (("arr.587.2038", Array (Int)),  CallDir (L "cast_fIAI.390",["Ti265.586.2037"; ],[]),
  Let (("Ti267.589.2039", Int),  Sub ("sp.400.1963",C 2 ),
  Let (("Ti268.590.2040", Int),  Ld ("arr.587.2038",V "n.583.2035",4),
  Let (("Tu27.591.2041", Unit),  St ("Ti268.590.2040","stack.399.1964",V "Ti267.589.2039",4),
  Let (("Ti270.593.2042", Int),  Sub ("sp.400.1963",C 1 ),
  Let (("stack.399.2187", Int),  Mov ("stack.399.1964"),
  Let (("sp.400.2186", Int),  Mov ("Ti270.593.2042"),
  Let (("Ti242.609.2275", Int),  Sub ("sp.400.2186",C 4 ),
  Let (("Ti244.611.2276", Int),  Sub ("Ti242.609.2275",C 1 ),
  Let (("v.612.2277", Int),  Ld ("stack.399.2187",V "Ti244.611.2276",4),
  Let (("Tu24.613.2278", Unit),  St ("v.612.2277","stack.399.2187",V "sp.400.2186",4),
  Let (("Ti246.615.2279", Int),  Add ("sp.400.2186",C 1 ),
  Let (("stack.399.2410", Int),  Mov ("stack.399.2187"),
  Let (("sp.400.2409", Int),  Mov ("Ti246.615.2279"),
  Let (("Ti242.609.2498", Int),  Sub ("sp.400.2409",C 8 ),
  Let (("Ti244.611.2499", Int),  Sub ("Ti242.609.2498",C 1 ),
  Let (("v.612.2500", Int),  Ld ("stack.399.2410",V "Ti244.611.2499",4),
  Let (("Tu24.613.2501", Unit),  St ("v.612.2500","stack.399.2410",V "sp.400.2409",4),
  Let (("Ti246.615.2502", Int),  Add ("sp.400.2409",C 1 ),
  Let (("stack.399.2633", Int),  Mov ("stack.399.2410"),
  Let (("sp.400.2632", Int),  Mov ("Ti246.615.2502"),
  Let (("Ti262.582.2703", Int),  Sub ("sp.400.2632",C 1 ),
  Let (("n.583.2704", Int),  Ld ("stack.399.2633",V "Ti262.582.2703",4),
  Let (("Ti264.585.2705", Int),  Sub ("sp.400.2632",C 2 ),
  Let (("Ti265.586.2706", Int),  Ld ("stack.399.2633",V "Ti264.585.2705",4),
  Let (("arr.587.2707", Array (Int)),  CallDir (L "cast_fIAI.390",["Ti265.586.2706"; ],[]),
  Let (("Ti267.589.2708", Int),  Sub ("sp.400.2632",C 2 ),
  Let (("Ti268.590.2709", Int),  Ld ("arr.587.2707",V "n.583.2704",4),
  Let (("Tu27.591.2710", Unit),  St ("Ti268.590.2709","stack.399.2633",V "Ti267.589.2708",4),
  Let (("Ti270.593.2711", Int),  Sub ("sp.400.2632",C 1 ),
  Let (("stack.399.2856", Int),  Mov ("stack.399.2633"),
  Let (("sp.400.2855", Int),  Mov ("Ti270.593.2711"),
  Let (("Ti242.609.2944", Int),  Sub ("sp.400.2855",C 1 ),
  Let (("Ti244.611.2945", Int),  Sub ("Ti242.609.2944",C 1 ),
  Let (("v.612.2946", Int),  Ld ("stack.399.2856",V "Ti244.611.2945",4),
  Let (("Tu24.613.2947", Unit),  St ("v.612.2946","stack.399.2856",V "sp.400.2855",4),
  Let (("Ti246.615.2948", Int),  Add ("sp.400.2855",C 1 ),
  Let (("stack.399.3079", Int),  Mov ("stack.399.2856"),
  Let (("sp.400.3078", Int),  Mov ("Ti246.615.2948"),
  Let (("Ti242.609.3167", Int),  Sub ("sp.400.3078",C 1 ),
  Let (("Ti244.611.3168", Int),  Sub ("Ti242.609.3167",C 1 ),
  Let (("v.612.3169", Int),  Ld ("stack.399.3079",V "Ti244.611.3168",4),
  Let (("Tu24.613.3170", Unit),  St ("v.612.3169","stack.399.3079",V "sp.400.3078",4),
  Let (("Ti246.615.3171", Int),  Add ("sp.400.3078",C 1 ),
  Let (("stack.399.3302", Int),  Mov ("stack.399.3079"),
  Let (("sp.400.3301", Int),  Mov ("Ti246.615.3171"),
  Let (("Ti73.813.3512", Int),  Sub ("sp.400.3301",C 1 ),
  Let (("v2.814.3513", Int),  Ld ("stack.399.3302",V "Ti73.813.3512",4),
  Let (("Ti75.816.3514", Int),  Sub ("sp.400.3301",C 2 ),
  Let (("v1.817.3515", Int),  Ld ("stack.399.3302",V "Ti75.816.3514",4),
  Let (("Ti77.819.3516", Int),  Sub ("sp.400.3301",C 2 ),
  Let (("Ti78.820.3517", Int),  Add ("v1.817.3515",V "v2.814.3513"),
  Let (("Tu5.821.3518", Unit),  St ("Ti78.820.3517","stack.399.3302",V "Ti77.819.3516",4),
  Let (("Ti80.823.3519", Int),  Sub ("sp.400.3301",C 1 ),
  Let (("stack.399.3525", Int),  Mov ("stack.399.3302"),
  Let (("sp.400.3524", Int),  Mov ("Ti80.823.3519"),
  Let (("Ti340.500.3539", Int),  Sub ("sp.400.3524",C 1 ),
  Let (("v.501.3540", Int),  Ld ("stack.399.3525",V "Ti340.500.3539",4),
  Let (("Tu33.502.3541", Unit),  St ("v.501.3540","stack.399.3525",V "sp.400.3524",4),
  Let (("Ti342.504.3542", Int),  Add ("sp.400.3524",C 1 ),
  Let (("stack.399.3748", Int),  Mov ("stack.399.3525"),
  Let (("sp.400.3747", Int),  Mov ("Ti342.504.3542"),
  Let (("Ti242.609.3836", Int),  Sub ("sp.400.3747",C 6 ),
  Let (("Ti244.611.3837", Int),  Sub ("Ti242.609.3836",C 1 ),
  Let (("v.612.3838", Int),  Ld ("stack.399.3748",V "Ti244.611.3837",4),
  Let (("Tu24.613.3839", Unit),  St ("v.612.3838","stack.399.3748",V "sp.400.3747",4),
  Let (("Ti246.615.3840", Int),  Add ("sp.400.3747",C 1 ),
  Let (("stack.399.3971", Int),  Mov ("stack.399.3748"),
  Let (("sp.400.3970", Int),  Mov ("Ti246.615.3840"),
  Let (("Ti242.609.4059", Int),  Sub ("sp.400.3970",C 11 ),
  Let (("Ti244.611.4060", Int),  Sub ("Ti242.609.4059",C 1 ),
  Let (("v.612.4061", Int),  Ld ("stack.399.3971",V "Ti244.611.4060",4),
  Let (("Tu24.613.4062", Unit),  St ("v.612.4061","stack.399.3971",V "sp.400.3970",4),
  Let (("Ti246.615.4063", Int),  Add ("sp.400.3970",C 1 ),
  Let (("stack.399.4194", Int),  Mov ("stack.399.3971"),
  Let (("sp.400.4193", Int),  Mov ("Ti246.615.4063"),
  Let (("Ti275.563.4251", Int),  Sub ("sp.400.4193",C 1 ),
  Let (("i.564.4252", Int),  Ld ("stack.399.4194",V "Ti275.563.4251",4),
  Let (("Ti277.566.4253", Int),  Sub ("sp.400.4193",C 2 ),
  Let (("Ti278.567.4254", Int),  Ld ("stack.399.4194",V "Ti277.566.4253",4),
  Let (("arr.568.4255", Array (Int)),  CallDir (L "cast_fIAI.390",["Ti278.567.4254"; ],[]),
  Let (("Ti280.570.4256", Int),  Sub ("sp.400.4193",C 3 ),
  Let (("n.571.4257", Int),  Ld ("stack.399.4194",V "Ti280.570.4256",4),
  Let (("Tu29.572.4258", Unit),  St ("n.571.4257","arr.568.4255",V "i.564.4252",4),
  Let (("Ti282.574.4259", Int),  Sub ("sp.400.4193",C 3 ),
  Let (("Ti283.575.4260", Int),  CallDir (L "cast_fAII.388",["arr.568.4255"; ],[]),
  Let (("Tu28.576.4261", Unit),  St ("Ti283.575.4260","stack.399.4194",V "Ti282.574.4259",4),
  Let (("Ti285.578.4262", Int),  Sub ("sp.400.4193",C 2 ),
  Let (("stack.399.4417", Int),  Mov ("stack.399.4194"),
  Let (("sp.400.4416", Int),  Mov ("Ti285.578.4262"),
  Let (("Ti242.609.4505", Int),  Sub ("sp.400.4416",C 10 ),
  Let (("Ti244.611.4506", Int),  Sub ("Ti242.609.4505",C 1 ),
  Let (("v.612.4507", Int),  Ld ("stack.399.4417",V "Ti244.611.4506",4),
  Let (("Tu24.613.4508", Unit),  St ("v.612.4507","stack.399.4417",V "sp.400.4416",4),
  Let (("Ti246.615.4509", Int),  Add ("sp.400.4416",C 1 ),
  Let (("stack.399.4640", Int),  Mov ("stack.399.4417"),
  Let (("sp.400.4639", Int),  Mov ("Ti246.615.4509"),
  Let (("c.689.4771", Int),  Set (1),
  Let (("Tu15.690.4772", Unit),  St ("c.689.4771","stack.399.4640",V "sp.400.4639",4),
  Let (("Ti184.692.4773", Int),  Add ("sp.400.4639",C 1 ),
  Let (("stack.399.4863", Int),  Mov ("stack.399.4640"),
  Let (("sp.400.4862", Int),  Mov ("Ti184.692.4773"),
  Let (("Ti73.813.5073", Int),  Sub ("sp.400.4862",C 1 ),
  Let (("v2.814.5074", Int),  Ld ("stack.399.4863",V "Ti73.813.5073",4),
  Let (("Ti75.816.5075", Int),  Sub ("sp.400.4862",C 2 ),
  Let (("v1.817.5076", Int),  Ld ("stack.399.4863",V "Ti75.816.5075",4),
  Let (("Ti77.819.5077", Int),  Sub ("sp.400.4862",C 2 ),
  Let (("Ti78.820.5078", Int),  Add ("v1.817.5076",V "v2.814.5074"),
  Let (("Tu5.821.5079", Unit),  St ("Ti78.820.5078","stack.399.4863",V "Ti77.819.5077",4),
  Let (("Ti80.823.5080", Int),  Sub ("sp.400.4862",C 1 ),
  Let (("stack.399.5086", Int),  Mov ("stack.399.4863"),
  Let (("sp.400.5085", Int),  Mov ("Ti80.823.5080"),
  Let (("Ti340.500.5100", Int),  Sub ("sp.400.5085",C 1 ),
  Let (("v.501.5101", Int),  Ld ("stack.399.5086",V "Ti340.500.5100",4),
  Let (("Tu33.502.5102", Unit),  St ("v.501.5101","stack.399.5086",V "sp.400.5085",4),
  Let (("Ti342.504.5103", Int),  Add ("sp.400.5085",C 1 ),
  Let (("stack.399.5309", Int),  Mov ("stack.399.5086"),
  Let (("sp.400.5308", Int),  Mov ("Ti342.504.5103"),
  Let (("Ti242.609.5397", Int),  Sub ("sp.400.5308",C 11 ),
  Let (("Ti244.611.5398", Int),  Sub ("Ti242.609.5397",C 1 ),
  Let (("v.612.5399", Int),  Ld ("stack.399.5309",V "Ti244.611.5398",4),
  Let (("Tu24.613.5400", Unit),  St ("v.612.5399","stack.399.5309",V "sp.400.5308",4),
  Let (("Ti246.615.5401", Int),  Add ("sp.400.5308",C 1 ),
  Let (("stack.399.5532", Int),  Mov ("stack.399.5309"),
  Let (("sp.400.5531", Int),  Mov ("Ti246.615.5401"),
  Let (("Ti242.609.5620", Int),  Sub ("sp.400.5531",C 11 ),
  Let (("Ti244.611.5621", Int),  Sub ("Ti242.609.5620",C 1 ),
  Let (("v.612.5622", Int),  Ld ("stack.399.5532",V "Ti244.611.5621",4),
  Let (("Tu24.613.5623", Unit),  St ("v.612.5622","stack.399.5532",V "sp.400.5531",4),
  Let (("Ti246.615.5624", Int),  Add ("sp.400.5531",C 1 ),
  Let (("stack.399.5755", Int),  Mov ("stack.399.5532"),
  Let (("sp.400.5754", Int),  Mov ("Ti246.615.5624"),
  Let (("Ti242.609.5843", Int),  Sub ("sp.400.5754",C 11 ),
  Let (("Ti244.611.5844", Int),  Sub ("Ti242.609.5843",C 1 ),
  Let (("v.612.5845", Int),  Ld ("stack.399.5755",V "Ti244.611.5844",4),
  Let (("Tu24.613.5846", Unit),  St ("v.612.5845","stack.399.5755",V "sp.400.5754",4),
  Let (("Ti246.615.5847", Int),  Add ("sp.400.5754",C 1 ),
  Let (("stack.399.5978", Int),  Mov ("stack.399.5755"),
  Let (("sp.400.5977", Int),  Mov ("Ti246.615.5847"),
  Let (("Ti242.609.6066", Int),  Sub ("sp.400.5977",C 11 ),
  Let (("Ti244.611.6067", Int),  Sub ("Ti242.609.6066",C 1 ),
  Let (("v.612.6068", Int),  Ld ("stack.399.5978",V "Ti244.611.6067",4),
  Let (("Tu24.613.6069", Unit),  St ("v.612.6068","stack.399.5978",V "sp.400.5977",4),
  Let (("Ti246.615.6070", Int),  Add ("sp.400.5977",C 1 ),
  Let (("stack.399.6201", Int),  Mov ("stack.399.5978"),
  Let (("sp.400.6200", Int),  Mov ("Ti246.615.6070"),
  Let (("Ti307.532.6236", Int),  Sub ("sp.400.6200",C 5 ),
  Let (("Ti308.533.6237", Int),  Sub ("Ti307.532.6236",C 5 ),
  Let (("Ti310.535.6238", Int),  Sub ("Ti308.533.6237",C 1 ),
  Let (("ret.536.6239", Int),  Ld ("stack.399.6201",V "Ti310.535.6238",4),
  Let (("Ti311.537.6240", Int),  Sub ("sp.400.6200",C 5 ),
  Let (("Ti312.538.6241", Int),  Sub ("Ti311.537.6240",C 5 ),
  Let (("Ti313.539.6242", Int),  Sub ("Ti312.538.6241",C 6 ),
  Let (("old_base.541.6243", Int),  Sub ("Ti313.539.6242",C 1 ),
  Let (("new_base.542.6244", Int),  Sub ("sp.400.6200",C 5 ),
  Let (("n.531.6235", Int),  Set (5),
  Let (("Ti315.543.6245", Int),  Set (0),
  Let (("sp2.544.6246", Int),  CallDir (L "frame_reset.392",["stack.399.6201"; "old_base.541.6243"; "new_base.542.6244"; "ret.536.6239"; "n.531.6235"; "Ti315.543.6245";], []),
  Let (("stack.399.6424", Int),  Mov ("stack.399.6201"),
  Let (("sp.400.6423", Int),  Mov ("sp2.544.6246"),
  Ans (CallDir (L "tracetj0.844",["stack.399.6424"; "sp.400.6423"; ],[])))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))),
  Let (("pc.402.1292", Int),  Set (52),
  Let (("bytecode.401.1293", Int),  CallDir (L "restore_min_caml_bp",[],[]),
  Let (("Ti195.686.1424", Int),  Add ("pc.402.1292",C 2 ),
  Ans (CallDir (L "guard_tracetj0.844",["stack.399.1295"; "sp2.683.1423"; "bytecode.401.1293"; "Ti195.686.1424"; ],[]))))))))))))))))))))))))))))))))))
[@@ocamlformat "disable"]

let%test _ =
  pp "[TEST] Applying const_fold a straight trace\n";
  Opt_defuse.exec trace_loop1 |> Asm.print_t;
  true
